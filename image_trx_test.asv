close all;
image = imread('Lenna.bmp');
[img_data, row_im, col_im, third_im] = image2data(im2gray(image),2);
target_len = ceil(length(img_data)/5);
pad_len    = target_len*5 - length(img_data);
img_data   = [img_data zeros(1,pad_len)];
img_data_32 = uint8(zeros(1,target_len));
% Serialize
for i=1:target_len
    word = img_data((i-1)*5+1)*16+img_data((i-1)*5+2)*8+img_data((i-1)*5+3)*4+img_data((i-1)*5+4)*2+img_data((i-1)*5+5);
    img_data_32(i) = word;
end

% Deserialize
img_data_recovered = zeros(1,target_len*5);
for i=1:target_len
    word = img_data_32(i);
    for j=1:5
        b5 = fix(word/16);
        img_d
        word = (word - b5)*2;
    end
    

end

%%
img_rx = data2image(img_data, row_im, col_im, third_im, 2);

% Show image
figure();
imshow(uint8(img_rx));